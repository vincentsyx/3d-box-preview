<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>3D Box Preview</title>
  <style>
    html, body {
      margin: 0;
      padding: 0;
      overflow: hidden;
      background: transparent;
    }
    canvas {
      display: block;
    }
  </style>
</head>
<body>

<script src="https://cdn.jsdelivr.net/npm/three@0.160.0/build/three.min.js"></script>
<script>
  // Scene setup
  const scene = new THREE.Scene();
  const camera = new THREE.PerspectiveCamera(50, window.innerWidth / window.innerHeight, 0.1, 1000);
  camera.position.z = 5;

  const renderer = new THREE.WebGLRenderer({ alpha: true, antialias: true });
  renderer.setSize(window.innerWidth, window.innerHeight);
  renderer.setClearColor(0x000000, 0); // Transparent background
  document.body.appendChild(renderer.domElement);

  // Lighting
  const light = new THREE.DirectionalLight(0xffffff, 1);
  light.position.set(5, 5, 5);
  scene.add(light);
  scene.add(new THREE.AmbientLight(0x404040));

  // Material (bright orange)
  const material = new THREE.MeshStandardMaterial({ color: 0xff6600 });

  let boxMesh = null;

  function createBox(length, width, height) {
    if (boxMesh) {
      scene.remove(boxMesh);
      boxMesh.geometry.dispose();
    }

    const geometry = new THREE.BoxGeometry(length, height, width);
    boxMesh = new THREE.Mesh(geometry, material);

    // Add white wireframe edges
    const edges = new THREE.EdgesGeometry(geometry);
    const line = new THREE.LineSegments(edges, new THREE.LineBasicMaterial({ color: 0xffffff }));
    boxMesh.add(line);

    scene.add(boxMesh);
  }

  // Default box
  createBox(1, 1, 1);

  // Animation loop
  function animate() {
    requestAnimationFrame(animate);
    if (boxMesh) boxMesh.rotation.y += 0.01;
    renderer.render(scene, camera);
  }
  animate();

  // Optional: listen for dimension messages from Lovable via postMessage
  window.addEventListener("message", (e) => {
    try {
      const { length, width, height } = JSON.parse(e.data);
      if (length && width && height) {
        createBox(parseFloat(length), parseFloat(width), parseFloat(height));
      }
    } catch (err) {
      // ignore invalid messages
    }
  });
</script>

</body>
</html>
